<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title>Scroll-driven navigation with markers and a narrative</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  
  <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
  
  <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
  
  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
  
  </style>
</head>

<body>
  <style>
      article {
        position:absolute;
        top:0;
        right:0;
        bottom:0px;
        left:0;
        overflow:auto;
        }
      .quiet {
        color:rgba(0,0,0,0.5);
        }
      .scroll {
        display:block;
        text-align:center;
        }
      .sections {
        background:rgba(255,255,255,0.5);
        width:240px;
        }
      section {
        padding:20px;
        color:rgba(0,0,0,0.5);
        -webkit-transition:background 500ms, color 500ms;
                transition:background 500ms, color 500ms;
        }
      section.active {
        background:#fff;
        color:#404040;
        }
  </style>
  

  <div id='map'></div>

  <article id='narrative'>
    <div class='sections prose'>
      
      <section id='cover' class='cover active'>
        <h2>Test Scrolling with Leaflet</h2>
        <small class='scroll quiet'>Scroll &#x25BE;</small>
      </section>

      <section id='one'>
        <h3>Test Location 1.</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque ullamcorper odio mollis, porta turpis eu, convallis mi. Nam ultricies ante non dolor elementum, quis varius mi viverra. Quisque purus lorem, congue ac est et, porttitor egestas dui. Curabitur euismod rutrum nibh, id aliquet odio finibus ut. Donec euismod nisl at nisi auctor vestibulum. Proin gravida nibh vel viverra sodales. Cras lacinia feugiat orci a faucibus. Maecenas congue lobortis est a dapibus. Phasellus a ultricies justo. Proin sit amet odio porta, condimentum ante vel, mattis lorem. Integer ac congue eros.</p>
      </section>

      <section id='two'>
        <h3>location 2</h3>
        <p>ALorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque ullamcorper odio mollis, porta turpis eu, convallis mi. Nam ultricies ante non dolor elementum, quis varius mi viverra. Quisque purus lorem, congue ac est et, porttitor egestas dui. Curabitur euismod rutrum nibh, id aliquet odio finibus ut. Donec euismod nisl at nisi auctor vestibulum. Proin gravida nibh vel viverra sodales. Cras lacinia feugiat orci a faucibus. Maecenas congue lobortis est a dapibus. Phasellus a ultricies justo. Proin sit amet odio porta, condimentum ante vel, mattis lorem. Integer ac congue eros. </p>
      </section>

      <section id='three'>
        <h3>Location 3</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque ullamcorper odio mollis, porta turpis eu, convallis mi. Nam ultricies ante non dolor elementum, quis varius mi viverra. Quisque purus lorem, congue ac est et, porttitor egestas dui. Curabitur euismod rutrum nibh, id aliquet odio finibus ut. Donec euismod nisl at nisi auctor vestibulum. Proin gravida nibh vel viverra sodales. Cras lacinia feugiat orci a faucibus. Maecenas congue lobortis est a dapibus. Phasellus a ultricies justo. Proin sit amet odio porta, condimentum ante vel, mattis lorem. Integer ac congue eros.</p>
      </section>
      
      <section id='four'>
        <h3>Location 4</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque ullamcorper odio mollis, porta turpis eu, convallis mi. Nam ultricies ante non dolor elementum, quis varius mi viverra. Quisque purus lorem, congue ac est et, porttitor egestas dui. Curabitur euismod rutrum nibh, id aliquet odio finibus ut. Donec euismod nisl at nisi auctor vestibulum. Proin gravida nibh vel viverra sodales. Cras lacinia feugiat orci a faucibus. Maecenas congue lobortis est a dapibus. Phasellus a ultricies justo. Proin sit amet odio porta, condimentum ante vel, mattis lorem. Integer ac congue eros.</p>
      </section>

      <section id='five'>
        <h3>location 5</h3>
        <p>MLorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque ullamcorper odio mollis, porta turpis eu, convallis mi. Nam ultricies ante non dolor elementum, quis varius mi viverra. Quisque purus lorem, congue ac est et, porttitor egestas dui. Curabitur euismod rutrum nibh, id aliquet odio finibus ut. Donec euismod nisl at nisi auctor vestibulum. Proin gravida nibh vel viverra sodales. Cras lacinia feugiat orci a faucibus. Maecenas congue lobortis est a dapibus. Phasellus a ultricies justo. Proin sit amet odio porta, condimentum ante vel, mattis lorem. Integer ac congue eros.</p>
      </section>

      <section id='six'>
        <h3>location 6</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque ullamcorper odio mollis, porta turpis eu, convallis mi. Nam ultricies ante non dolor elementum, quis varius mi viverra. Quisque purus lorem, congue ac est et, porttitor egestas dui. Curabitur euismod rutrum nibh, id aliquet odio finibus ut. Donec euismod nisl at nisi auctor vestibulum. Proin gravida nibh vel viverra sodales. Cras lacinia feugiat orci a faucibus. Maecenas congue lobortis est a dapibus. Phasellus a ultricies justo. Proin sit amet odio porta, condimentum ante vel, mattis lorem. Integer ac congue eros.</p>
      </section>

      <section id='seven'>
        <h3>location 7</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque ullamcorper odio mollis, porta turpis eu, convallis mi. Nam ultricies ante non dolor elementum, quis varius mi viverra. Quisque purus lorem, congue ac est et, porttitor egestas dui. Curabitur euismod rutrum nibh, id aliquet odio finibus ut. Donec euismod nisl at nisi auctor vestibulum. Proin gravida nibh vel viverra sodales. Cras lacinia feugiat orci a faucibus. Maecenas congue lobortis est a dapibus. Phasellus a ultricies justo. Proin sit amet odio porta, condimentum ante vel, mattis lorem. Integer ac congue eros.</p>
      </section>

      <section id='eight'>
        <h3>location 8</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque ullamcorper odio mollis, porta turpis eu, convallis mi. Nam ultricies ante non dolor elementum, quis varius mi viverra. Quisque purus lorem, congue ac est et, porttitor egestas dui. Curabitur euismod rutrum nibh, id aliquet odio finibus ut. Donec euismod nisl at nisi auctor vestibulum. Proin gravida nibh vel viverra sodales. Cras lacinia feugiat orci a faucibus. Maecenas congue lobortis est a dapibus. Phasellus a ultricies justo. Proin sit amet odio porta, condimentum ante vel, mattis lorem. Integer ac congue eros.</p>
      </section>
    </div>
  </article>

  <script>
  L.mapbox.accessToken = 'pk.eyJ1IjoibGF1cmVuYmhlbmRyaWNrcyIsImEiOiJjaWs1cnd3YmowMDhucHRrc3Q5a2J5cjE3In0.j9sCY68mpCwY6YIOOWyIEQ';
  

  // In this case, we just hardcode data into the file. This could be dynamic.
  // The important part about this data is that the 'id' property matches
  // the HTML above - that's how we figure out how to link up the
  // map and the data.
  var places = { type: 'FeatureCollection', features: [
  { geometry: { type: "Point", coordinates: [-0.12960000, 51.50110000] },
    properties: { id: "cover", zoom: 9 }, type: 'Feature' },
  { geometry: { type: "Point", coordinates: [-0.15591514, 51.51830379] },
    properties: { id: "one" }, type: 'Feature' },
  { geometry: { type: "Point", coordinates: [-0.07571203, 51.51424049] },
    properties: { id: "two" }, type: 'Feature' },
  { geometry: { type: "Point", coordinates: [-0.08533793, 51.50438536] },
    properties: { id: "three" }, type: 'Feature' },
  { geometry: { type: "Point", coordinates: [0.05991101, 51.48752939] },
    properties: { id: "four" }, type: 'Feature' },
  { geometry: { type: "Point", coordinates: [-0.18335806, 51.49439521] },
    properties: { id: "five" }, type: 'Feature' },
  { geometry: { type: "Point", coordinates: [-0.19684993, 51.5033856] },
    properties: { id: "six" }, type: 'Feature' },
  { geometry: { type: "Point", coordinates: [-0.10669358, 51.51433123] },
    properties: { id: "seven" }, type: 'Feature' },
  { geometry: { type: "Point", coordinates: [-0.12416858, 51.50779757] },
    properties: { id: "eight" }, type: 'Feature' }
  ]};

  var map = L.mapbox.map('map', 'mapbox.streets', {
      zoomControl: false
  });

  L.tileLayer('https://api.mapbox.com/styles/v1/laurenbhendricks/cjftxv7us3shz2rqm2grktj7o/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibGF1cmVuYmhlbmRyaWNrcyIsImEiOiJjaWs1cnd3YmowMDhucHRrc3Q5a2J5cjE3In0.j9sCY68mpCwY6YIOOWyIEQ', {
      maxZoom: 14,
      minZoom: 3,
      attribution: 'Map Style Â© <a href="http://mapbox.com">Mapbox</a>',
      id: 'mapbox.light'
      }).addTo(map);


  var placesLayer = L.mapbox.featureLayer(places)
      .addTo(map);

  // Ahead of time, select the elements we'll need -
  // the narrative container and the individual sections
  var narrative = document.getElementById('narrative'),
      sections = narrative.getElementsByTagName('section'),
      currentId = '';

  setId('cover');

  function setId(newId) {
      // If the ID hasn't actually changed, don't do anything
      if (newId === currentId) return;
      // Otherwise, iterate through layers, setting the current
      // marker to a different color and zooming to it.
      placesLayer.eachLayer(function(layer) {
          if (layer.feature.properties.id === newId) {
              map.setView(layer.getLatLng(), layer.feature.properties.zoom || 14);
              layer.setIcon(L.mapbox.marker.icon({
                  'marker-color': '#a8f'
              }));
          } else {
              layer.setIcon(L.mapbox.marker.icon({
                  'marker-color': '#404040'
              }));
          }
      });
      // highlight the current section
      for (var i = 0; i < sections.length; i++) {
          sections[i].className = sections[i].id === newId ? 'active' : '';
      }
      // And then set the new id as the current one,
      // so that we know to do nothing at the beginning
      // of this function if it hasn't changed between calls
      currentId = newId;
  }

  // If you were to do this for real, you would want to use
  // something like underscore's _.debounce function to prevent this
  // call from firing constantly.
  narrative.onscroll = function(e) {
      var narrativeHeight = narrative.offsetHeight;
      var newId = currentId;
      // Find the section that's currently scrolled-to.
      // We iterate backwards here so that we find the topmost one.
      for (var i = sections.length - 1; i >= 0; i--) {
          var rect = sections[i].getBoundingClientRect();
          if (rect.top >= 0 && rect.top <= narrativeHeight) {
              newId = sections[i].id;
          }
      };
      setId(newId);
  };
  </script>
  </body>
</html>